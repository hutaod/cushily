# è„šæ‰‹æ¶æ­å»º

## ä¸»è¦åŠŸèƒ½ï¼š

- ä¿¡æ¯å±•ç¤ºï¼Œå¦‚ vite --helpã€vite --version
- å­å‘½ä»¤åˆ†å‘ï¼Œå¦‚ vite serveã€vite build
- å‚æ•°è§£æï¼Œå¦‚ vite --port=3000
- ä¿¡æ¯äº¤äº’ï¼Œå¦‚å®ç°ç»ˆç«¯çš„å¤šé€‰ã€è¾“å…¥ç­‰åŠŸèƒ½
- å…·ä½“åŠŸèƒ½å®ç°

## å‘½ä»¤è§£ææ–¹æ¡ˆè°ƒç ”å’Œé€‰æ‹©

ç¤¾åŒºå¸¸è§çš„ CLI æ–¹æ¡ˆï¼ŒçŸ¥ååº¦æ¯”è¾ƒé«˜çš„æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š

- Commander.js å±äº Node.js ç”Ÿæ€ä¸­æœ€æ—©è¯ç”Ÿçš„ CLI æ–¹æ¡ˆï¼Œç”± Node.js å¤§ç¥ TJ è¿›è¡Œå¼€å‘ï¼Œå±äºå…ƒè€çº§åˆ«çš„æ–¹æ¡ˆã€‚
- Yargs è™½ç„¶æ˜¯åèµ·ä¹‹ç§€ï¼Œä½†åŠŸèƒ½è¶³å¤Ÿé½å…¨ï¼Œéå¸¸å¼ºå¤§ï¼Œæ¯”å¦‚å†…ç½®å‚æ•°æ ¡éªŒã€ä¿¡æ¯äº¤äº’ç­‰æ¨¡å—ï¼Œæ¯”è¾ƒé€‚åˆå¤æ‚çš„ CLI å¼€å‘ã€‚
- CAC ç¤¾åŒºæ–°ç§€ï¼Œä¼˜ç‚¹æ˜¯è½»é‡ã€ä½¿ç”¨æ–¹ä¾¿ï¼Œæ•´ä½“çš„åŒ…ä½“ç§¯åªæœ‰ä¸åˆ° 10 KBï¼Œæ˜¯ Yargs çš„ ååˆ†ä¹‹ä¸€ï¼ŒCommander çš„ ä¸‰åˆ†ä¹‹ä¸€ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ Vite ç›®å‰æ‰€å†…ç½®çš„ CLI æ­å»ºæ–¹æ¡ˆã€‚

è€ƒè™‘åˆ°é¡¹ç›® CLI å¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ï¼Œç”¨ CAC å®Œå…¨èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œå¹¶ä¸”ç›¸æ¯” Yargs å’Œ Commander è¿˜èƒ½å‡å°‘ä¾èµ–ä½“ç§¯ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©CAC ä½œä¸ºåç»­ CLI çš„å¼€å‘æ–¹æ¡ˆã€‚

## ç¼–ç å®ç°

1. åˆå§‹åŒ–å·¥ç¨‹ï¼š

```bash
# åˆ›å»ºä½ çš„cliå·¥ç¨‹æ–‡ä»¶å¤¹
mkdir youer-cli-project
# åˆå§‹åŒ–package.json
pnpm init
```

2. å®‰è£…ç›¸å…³ä¾èµ–

ä¸ºäº†è®©ä»£ç æ›´å¥½ï¼Œä½¿ç”¨ Typescript è¿›è¡Œå¼€å‘ï¼Œå®‰è£… Typescript ç›¸å…³ä¾èµ–ï¼š

```bash
pnpm add typescript @types/node -D
```

å®‰è£…å®Œåæ–°å¢ Typescript é…ç½®
```json
{
  "compilerOptions": {
    // ä»£ç ç›®å½•
    "rootDir": "src",
    // è®¾ç½®ä»£ç éœ€è¦ç”¨åˆ°çš„ JavaScript ç‰ˆæœ¬
    "target": "ESNext",
    // ä»£ç è¾“å‡ºç›®å½•
    "outDir": "dist",
    // ç”Ÿæˆä»€ä¹ˆç±»å‹çš„ä»£ç æ¨¡å—ï¼Œç»™ nodejs ç›´æ¥ä½¿ç”¨çš„ä¸€èˆ¬æ˜¯ CommonJS
    "module": "CommonJS"
  }
}
```

å®‰è£… cac å‘½ä»¤è¡Œè§£æå·¥å…·

```bash
pnpm add cac
```

3. é…ç½® scripts

æ¥ç€æˆ‘ä»¬åœ¨ package.json ä¸­æ·»åŠ å¯¹åº”çš„ script æ¥ç¼–è¯‘ ts ä»£ç :
```json
"scripts": {
  // -w è¡¨ç¤ºç›‘å¬æ¨¡å¼ï¼Œè¿™æ ·ä¿®æ”¹æ–‡ä»¶åå°†ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°ç¼–è¯‘
  "dev": "tsc -w"
},
```

4. ç¼–å†™ä»£ç 

ç¼–å†™ cli ä»£ç 

```ts
// src/node/cli
import cac from "cac"

// å£°æ˜ cli `åç§°`å’Œ`ç‰ˆæœ¬`
const cli = cac("xxx").version("0.0.0")

// å£°æ˜ å¼€å‘-dev å‘½ä»¤
cli.command('dev [root]', 'start dev server').action(async (root: string) => {
  console.log("dev", root)
})

// å£°æ˜ æ‰“åŒ…-build å‘½ä»¤
cli.command('build [root]', 'build in production').action(async (root: string) => {
  console.log("build", root)
})

// å£°æ˜ é¢„è§ˆ-preview å‘½ä»¤
cli.command('preview [root]', 'preview app').action(async (root: string) => {
  console.log("preview", root)
})

// å¼€å§‹è§£æå‘½ä»¤
cli.parse();
```

æ‰§è¡Œ npm run dev å¼€å§‹è‡ªåŠ¨ç¼–è¯‘ä»£ç ï¼Œè¿™æ—¶å€™ä¼šç”Ÿæˆ dist/xxx.jsã€‚

ä½†ç°åœ¨è¿˜æ²¡åŠæ³•é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œï¼Œä¸‹é¢è¿›è¡Œæ³¨å†Œ cli å‘½ä»¤ï¼š

```js
// bin/xxx.js
#!/usr/bin/env node
require("../dist/cli.js");
```

```json
// package.json
{
  "bin": {
    "xxx": "bin/xxx.js"
  }
}
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬ä»…éœ€æ‰§è¡Œ `npm link` å°±å¯ä»¥å°† xxx å‘½ä»¤ link åˆ°å…¨å±€ã€‚ä¹‹åä½ å¯ä»¥ç”¨å¦‚ä¸‹çš„å‘½ä»¤è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ï¼š

```bash
xxx dev docs
xxx build docs
xxx preview docs
```

å¦‚æœå‘½ä»¤è¡Œçš„æ˜¾ç¤ºåˆ†åˆ«ä¸ºï¼š

```bash
dev docs
build docs
preview docs
```

åˆ™è¡¨ç¤º CLI å·¥å…·å°±å·²ç»æˆåŠŸåœ°æ­å»ºèµ·æ¥å•¦ğŸ‰ã€‚
